version: '3.8'

services:
  ico-api:
    build: .
    container_name: ico-api
    environment:
      - NODE_ENV=production
      - PORT=${PORT:-26002}
      - DB_PATH=/app/data/ico.db
      - LOG_LEVEL=${LOG_LEVEL:-info}
    ports:
      - "${PORT:-26002}:${PORT:-26002}"
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
      - ./register-of-data-controllers.csv:/app/register-of-data-controllers.csv
    restart: unless-stopped
    networks:
      - ico-network

  ico-setup:
    build: .
    container_name: ico-setup
    environment:
      - NODE_ENV=production
      - DB_PATH=/app/data/ico.db
      - LOG_LEVEL=${LOG_LEVEL:-info}
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
      - ./register-of-data-controllers.csv:/app/register-of-data-controllers.csv
    networks:
      - ico-network
    profiles:
      - setup
    command: ["node", "dist/scripts/setup-db-fast.js"]

networks:
  ico-network:
    driver: bridge